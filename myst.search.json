{"version":"1","records":[{"hierarchy":{"lvl1":"Bibliography"},"type":"lvl1","url":"/bibliography","position":0},{"hierarchy":{"lvl1":"Bibliography"},"content":"","type":"content","url":"/bibliography","position":1},{"hierarchy":{"lvl1":"World of energy"},"type":"lvl1","url":"/","position":0},{"hierarchy":{"lvl1":"World of energy"},"content":"List of planned topics:\n\nelectricity markets / prices\n\nweather as driver of residual load\n\nweather forecasting\n\ngrid congestion\n\nbattery storage\n\nbattery optimization","type":"content","url":"/","position":1},{"hierarchy":{"lvl1":"Resources"},"type":"lvl1","url":"/markdown/resources","position":0},{"hierarchy":{"lvl1":"Resources"},"content":"Capture prices as published by \n\nNetztransparenz:","type":"content","url":"/markdown/resources","position":1},{"hierarchy":{"lvl1":"Resources","lvl2":"Prices"},"type":"lvl2","url":"/markdown/resources#prices","position":2},{"hierarchy":{"lvl1":"Resources","lvl2":"Prices"},"content":"From \n\ndestatis\n\nFrom \n\nsmard:\n\nFrom \n\ntrading economics:\n\nFrom \n\nEMBER:\n\nRegarding SRMC:\n\nhttps://​support​.montel​.energy​/how​-are​-short​-run​-marginal​-costs​-srmc​-calculated​-in​-montel​-online\n\nhttps://​ember​-energy​.org​/data​/european​-electricity​-prices​-and​-costs​/​#methodology","type":"content","url":"/markdown/resources#prices","position":3},{"hierarchy":{"lvl1":"Resources","lvl2":"Weather"},"type":"lvl2","url":"/markdown/resources#weather","position":4},{"hierarchy":{"lvl1":"Resources","lvl2":"Weather"},"content":"","type":"content","url":"/markdown/resources#weather","position":5},{"hierarchy":{"lvl1":"Resources","lvl2":"Data"},"type":"lvl2","url":"/markdown/resources#data","position":6},{"hierarchy":{"lvl1":"Resources","lvl2":"Data"},"content":"Investing.com:\n\nCarbon Emissions Futures Prices: \n\nhttps://​www​.investing​.com​/commodities​/carbon​-emissions​-historical​-data\n\nRotterdam Coal Futures Prices: \n\nhttps://​www​.investing​.com​/commodities​/rotterdam​-coal​-futures​-historical​-data","type":"content","url":"/markdown/resources#data","position":7},{"hierarchy":{"lvl1":"Electricity prices in Germany"},"type":"lvl1","url":"/notebooks/smard-de-prices","position":0},{"hierarchy":{"lvl1":"Electricity prices in Germany"},"content":"This notebook loads and visualizes day-ahead electricity prices for the\nGerman-Luxembourg market area from SMARD data.","type":"content","url":"/notebooks/smard-de-prices","position":1},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Background"},"type":"lvl2","url":"/notebooks/smard-de-prices#background","position":2},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Background"},"content":"The SMARD platform (operated by the German Federal Network Agency,\nBundesnetzagentur) is the primary hub for high-resolution electricity market\ndata in Germany. It serves as a transparent “scoreboard” for the energy\ntransition.","type":"content","url":"/notebooks/smard-de-prices#background","position":3},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"What are SMARD Electricity Prices (DE/LU)?","lvl2":"Background"},"type":"lvl3","url":"/notebooks/smard-de-prices#what-are-smard-electricity-prices-de-lu","position":4},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"What are SMARD Electricity Prices (DE/LU)?","lvl2":"Background"},"content":"The DE/LU price refers to the wholesale cost of electricity for the joint\nbidding zone comprising Germany and Luxembourg.\n\nUniform Price: Within this zone, electricity is treated as if it were on\na “copper plate”—the wholesale price is the same regardless of location.\n\nWholesale vs. Retail: These are wholesale prices (what energy suppliers\npay on the exchange). Retail bills include additional taxes, grid fees, and\nlevies.\n\nVolatility: Prices fluctuate hourly based on weather (wind/solar), demand\n(industrial activity), and fuel prices (natural gas).","type":"content","url":"/notebooks/smard-de-prices#what-are-smard-electricity-prices-de-lu","position":5},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"What is Day-Ahead?","lvl2":"Background"},"type":"lvl3","url":"/notebooks/smard-de-prices#what-is-day-ahead","position":6},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"What is Day-Ahead?","lvl2":"Background"},"content":"The Day-Ahead Market is the primary exchange for electricity. Because\nelectricity is difficult to store, it must be traded before production.\n\nThe Auction: Every day at 12:00 CET, an auction takes place for each\nhour of the following day.\n\nClearing Price: The exchange algorithm finds where supply meets demand.\nThis “Market Clearing Price” is what SMARD publishes.","type":"content","url":"/notebooks/smard-de-prices#what-is-day-ahead","position":7},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Connection to Other Bidding Zones","lvl2":"Background"},"type":"lvl3","url":"/notebooks/smard-de-prices#connection-to-other-bidding-zones","position":8},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Connection to Other Bidding Zones","lvl2":"Background"},"content":"Germany/Luxembourg is part of the Single Day-Ahead Coupling (SDAC), linking\nmost of Europe. Through interconnectors, electricity flows from low-price areas\n(high supply) to high-price areas (high demand). When cables are congested,\nprices “split” between zones.","type":"content","url":"/notebooks/smard-de-prices#connection-to-other-bidding-zones","position":9},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Daylight Savings Time Transitions","lvl2":"Background"},"type":"lvl3","url":"/notebooks/smard-de-prices#daylight-savings-time-transitions","position":10},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Daylight Savings Time Transitions","lvl2":"Background"},"content":"Spring (23-hour day): When clocks jump from 02:00 to 03:00, the 2 AM hour\nis missing from the data.\n\nAutumn (25-hour day): When clocks fall back, the extra hour is labeled\nas 3A and 3B (or similar). This often shows very low prices due to\nreduced demand and extra generation capacity.","type":"content","url":"/notebooks/smard-de-prices#daylight-savings-time-transitions","position":11},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Observations from the Data"},"type":"lvl2","url":"/notebooks/smard-de-prices#observations-from-the-data","position":12},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Observations from the Data"},"content":"","type":"content","url":"/notebooks/smard-de-prices#observations-from-the-data","position":13},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"The 2021-2023 Energy Crisis","lvl2":"Observations from the Data"},"type":"lvl3","url":"/notebooks/smard-de-prices#the-2021-2023-energy-crisis","position":14},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"The 2021-2023 Energy Crisis","lvl2":"Observations from the Data"},"content":"The most striking feature in the data is the dramatic price surge from mid-2021\nthrough early 2023, with monthly averages peaking above 460 EUR/MWh in\nAugust 2022—roughly 10x the pre-crisis baseline of ~40 EUR/MWh.\n\nPrimary causes:\n\nPost-COVID recovery (2021): Economic rebound increased global energy\ndemand, particularly for LNG in Asia, tightening European gas supplies.\n\nRussia’s invasion of Ukraine (Feb 2022): Russia had supplied ~44% of\nEU natural gas imports. The subsequent supply cuts caused gas prices to surge\n5-fold, directly impacting electricity prices since gas plants often set the\nmarginal price.\n\nMerit order effect: In electricity markets, the most expensive plant\nneeded to meet demand sets the price for all generators. With gas prices\nsoaring, this “marginal” plant became extremely costly.\n\nThe crisis peaked in August 2022 when wholesale prices exceeded 850 EUR/MWh.","type":"content","url":"/notebooks/smard-de-prices#the-2021-2023-energy-crisis","position":15},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Negative Prices","lvl2":"Observations from the Data"},"type":"lvl3","url":"/notebooks/smard-de-prices#negative-prices","position":16},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Negative Prices","lvl2":"Observations from the Data"},"content":"The hourly data shows prices occasionally dropping below zero (visible as\ndownward spikes reaching -200 to -500 EUR/MWh). Negative prices mean\nproducers must pay to have their electricity taken off the grid.\n\nWhy this happens:\n\nRenewable oversupply: On sunny, windy days (especially weekends), solar\nand wind generation can exceed demand. Germany added massive renewable\ncapacity—the EU installed a record 56 GW of solar in 2023 alone.\n\nInflexible generation: Nuclear and some coal plants cannot quickly ramp\ndown, so they pay to keep running rather than face costly shutdown/restart.\n\nGrid congestion: Limited transmission capacity can trap excess power in\ncertain regions.\n\nTiming mismatch: Peak solar production (midday) doesn’t align with peak\ndemand (mornings/evenings), especially on low-demand weekends.\n\nIn H1 2025, Germany experienced 389 hours of negative day-ahead prices.","type":"content","url":"/notebooks/smard-de-prices#negative-prices","position":17},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Positive Price Spikes","lvl2":"Observations from the Data"},"type":"lvl3","url":"/notebooks/smard-de-prices#positive-price-spikes","position":18},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl3":"Positive Price Spikes","lvl2":"Observations from the Data"},"content":"Extreme upward spikes (600-900+ EUR/MWh) occur during supply scarcity events:\n\nDunkelflaute: German for “dark doldrums”—periods of cold, cloudy, windless\nweather when renewable output collapses. In December 2024, intraday prices\nbriefly hit ~1,000 EUR/MWh during an extended Dunkelflaute.\n\nPlant outages: Unplanned maintenance or failures of conventional plants\nduring high-demand periods exacerbate scarcity.\n\nPeak demand: Cold winter evenings with high heating demand and low\nrenewable output force reliance on expensive gas “peaker” plants.\n\nThese dynamics illustrate why flexibility (storage, demand response, grid\nexpansion) is critical for integrating high shares of variable renewables.\n\n","type":"content","url":"/notebooks/smard-de-prices#positive-price-spikes","position":19},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Data Source"},"type":"lvl2","url":"/notebooks/smard-de-prices#data-source","position":20},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Data Source"},"content":"The price data is downloaded from the SMARD API using the following function:\n\ndef download_smard_data(\n    region: str, \n    resolution: str, \n    variable: int, \n    variable_name: str,\n    start_time: Optional[datetime] = None\n) -> pd.DataFrame:\n    \"\"\"Download data from SMARD API for given parameters.\n    \n    Note: The SMARD API uses a block-based data retrieval system where we first get\n    timestamps marking the start of data blocks (e.g. weekly chunks), then fetch\n    the actual observations for each block in separate requests.\n    \n    Args:\n        region: Region code (e.g. 'DE' for Germany)\n        resolution: Time resolution (e.g. 'day', 'hour')\n        variable: Variable ID for the type of power data\n        variable_name: Name of the variable to use as column label\n        start_time: Optional datetime to specify start of data collection.\n                   If None, returns all available data.\n    \n    Returns:\n        pd.DataFrame: DataFrame with timestamp index and value column\n        \n    Raises:\n        RuntimeError: If there's an error fetching data from the API\n    \"\"\"\n    base_url = \"https://www.smard.de/app\"\n    \n    # Step 1: Get available timestamps\n    index_url = f\"{base_url}/chart_data/{variable}/{region}/index_{resolution}.json\"\n    response = requests.get(index_url)\n    \n    if response.status_code != 200:\n        raise RuntimeError(f\"Error fetching timestamps: {response.status_code}\")\n        \n    timestamps = response.json()[\"timestamps\"]\n    \n    if not timestamps:\n        raise RuntimeError(\"No timestamps available for the specified parameters\")\n\n    # Filter timestamps if start_time is provided\n    if start_time:\n        start_timestamp = int(start_time.timestamp() * 1000)  # Convert to milliseconds\n        timestamps = [ts for ts in timestamps if ts >= start_timestamp]\n        \n        if not timestamps:\n            raise RuntimeError(f\"No data available after {start_time}\")\n\n    # Initialize empty lists to store all data\n    all_timestamps = []\n    all_values = []\n\n    # Step 2: Get data for each timestamp\n    for timestamp in timestamps:\n        data_url = f\"{base_url}/chart_data/{variable}/{region}/{variable}_{region}_{resolution}_{timestamp}.json\"\n        data_response = requests.get(data_url)\n        \n        if data_response.status_code != 200:\n            print(f\"Warning: Error fetching data for timestamp {timestamp}: {data_response.status_code}\")\n            continue\n            \n        data = data_response.json()\n        series_data: List[Tuple[int, float]] = data[\"series\"]\n        \n        # Extract timestamps and values\n        ts = [datetime.fromtimestamp(ts/1000) for ts, _ in series_data]\n        values = [val for _, val in series_data]\n        \n        all_timestamps.extend(ts)\n        all_values.extend(values)\n    \n    # Create and return dataframe\n    df = pd.DataFrame({\n        'timestamp': all_timestamps,\n        variable_name: all_values\n    })\n    \n    # Sort by timestamp and remove duplicates\n    df = df.sort_values('timestamp').drop_duplicates(subset='timestamp')\n    df.set_index('timestamp', inplace=True)\n    df = df.dropna()\n    \n    return df \n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\nfrom woe.paths import ProjPaths\n\n\n\n# Load the price data\npaths = ProjPaths()\nprices_file = paths.smard_prices_file\n\nprint(f\"Loading data from: {prices_file}\")\ndf = pd.read_parquet(prices_file)\n\nprint(f\"Data shape: {df.shape}\")\nprint(f\"Date range: {df.index.min()} to {df.index.max()}\")\ndf.head()\n\n\n\n\n\n# Time series plot of electricity prices\nfig, ax = plt.subplots(figsize=(14, 6))\n\nax.plot(df.index, df[\"PRICE_DE_LU\"], linewidth=0.5, alpha=0.8)\nax.set_xlabel(\"Date\")\nax.set_ylabel(\"Price (EUR/MWh)\")\nax.set_title(\"DE/LU Day-Ahead Electricity Prices\")\nax.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n# Monthly average prices\nmonthly_avg = df.resample(\"ME\").mean()\n\nfig, ax = plt.subplots(figsize=(14, 6))\n\nax.plot(monthly_avg.index, monthly_avg[\"PRICE_DE_LU\"], marker=\"o\", markersize=3)\nax.set_xlabel(\"Date\")\nax.set_ylabel(\"Price (EUR/MWh)\")\nax.set_title(\"DE/LU Monthly Average Electricity Prices\")\nax.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/smard-de-prices#data-source","position":21},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Intraday Seasonality"},"type":"lvl2","url":"/notebooks/smard-de-prices#intraday-seasonality","position":22},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Intraday Seasonality"},"content":"The charts above use hourly resolution which compresses daily patterns. Below\nwe zoom into a three-week window so that the recurring daily and weekly price\ncycles become clearly visible.\n\nTypical patterns:\n\nMorning ramp (06:00–09:00): Prices rise sharply as households and\nindustry come online.\n\nSolar dip (11:00–15:00): On sunny days, abundant solar generation\npushes prices down around midday—sometimes below zero.\n\nEvening peak (17:00–20:00): Demand stays high while solar fades,\nforcing expensive gas plants onto the grid.\n\nWeekend effect: Lower industrial demand on Saturdays and Sundays\ncompresses the entire price curve downward.\n\nfrom datetime import datetime, timedelta\n\n# Pick a recent 3-week window ending at the last full day in the hourly data\nend_date = df.index.max().normalize()\nstart_date = end_date - timedelta(weeks=3)\n\nsub_prices = df.loc[start_date:end_date].copy()\nprint(f\"Hourly prices: {start_date.date()} to {end_date.date()} ({len(sub_prices)} records)\")\n\n\n\nfig, ax = plt.subplots(figsize=(14, 5))\n\nimport matplotlib.dates as mdates\n\nax.plot(sub_prices.index, sub_prices[\"PRICE_DE_LU\"], linewidth=0.6)\nax.set_ylabel(\"Price (EUR/MWh)\")\nax.set_title(\n    f\"Hourly DE/LU Day-Ahead Prices \"\n    f\"({start_date.strftime('%d %b')} – {end_date.strftime('%d %b %Y')})\"\n)\nax.grid(True, alpha=0.3)\n\n# Show every day on the x-axis\nax.xaxis.set_major_locator(mdates.DayLocator())\nax.xaxis.set_major_formatter(mdates.DateFormatter(\"%d %b\"))\nfig.autofmt_xdate(rotation=45)\n\n# Shade weekends\nfor dt in pd.date_range(start_date, end_date, freq=\"D\"):\n    if dt.weekday() >= 5:  # Saturday=5, Sunday=6\n        ax.axvspan(dt, dt + timedelta(days=1), alpha=0.08, color=\"grey\")\n\nax.legend([\"Price\", \"Weekend\"], loc=\"upper right\")\nfig.tight_layout()\nplt.show()\n\n\n\n# Average daily profile across the 3-week window\nsub_prices[\"hour\"] = sub_prices.index.hour + sub_prices.index.minute / 60\nsub_prices[\"is_weekend\"] = sub_prices.index.weekday >= 5\n\nweekday_profile = sub_prices[~sub_prices[\"is_weekend\"]].groupby(\"hour\")[\"PRICE_DE_LU\"].mean()\nweekend_profile = sub_prices[sub_prices[\"is_weekend\"]].groupby(\"hour\")[\"PRICE_DE_LU\"].mean()\n\nfig, ax = plt.subplots(figsize=(10, 5))\n\nax.plot(weekday_profile.index, weekday_profile.values, label=\"Weekday avg\", linewidth=1.5)\nax.plot(weekend_profile.index, weekend_profile.values, label=\"Weekend avg\", linewidth=1.5)\nax.set_xlabel(\"Hour of day\")\nax.set_ylabel(\"Price (EUR/MWh)\")\nax.set_title(\n    f\"Average Daily Price Profile \"\n    f\"({start_date.strftime('%d %b')} – {end_date.strftime('%d %b %Y')})\"\n)\nax.set_xlim(0, 24)\nax.set_xticks(range(0, 25, 3))\nax.legend()\nax.grid(True, alpha=0.3)\n\n# Clean up helper columns\nsub_prices.drop(columns=[\"hour\", \"is_weekend\"], inplace=True)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/smard-de-prices#intraday-seasonality","position":23},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Electricity Prices and Natural Gas"},"type":"lvl2","url":"/notebooks/smard-de-prices#electricity-prices-and-natural-gas","position":24},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Electricity Prices and Natural Gas"},"content":"In European electricity markets, natural gas plants frequently set the\nmarginal (price-setting) price because they sit at the expensive end of the\nmerit order. When gas prices rise, the cost of running these plants increases,\nwhich lifts the clearing price for all generators—even low-cost renewables.\n\nThe chart below overlays monthly average electricity prices with the TTF\n(Title Transfer Facility) natural gas front-month futures price. TTF is the\nbenchmark hub for north-west European gas trading and the most liquid gas\ncontract on the continent.\n\nThe tight co-movement during 2021-2023 illustrates how the gas supply crisis\ndirectly transmitted into record electricity prices.\n\n# Load TTF gas prices\ngas_df = pd.read_parquet(paths.ttf_gas_prices_file)\ngas_df.index = pd.to_datetime(gas_df.index)\n\nprint(f\"Gas prices: {len(gas_df)} records\")\nprint(f\"Date range: {gas_df.index.min().date()} to {gas_df.index.max().date()}\")\n\n\n\n# Monthly averages for both series\nmonthly_power = df.resample(\"ME\").mean()\nmonthly_gas = gas_df[\"Close\"].resample(\"ME\").mean()\n\nfig, ax1 = plt.subplots(figsize=(14, 6))\n\ncolor_power = \"tab:blue\"\nax1.plot(monthly_power.index, monthly_power[\"PRICE_DE_LU\"],\n         color=color_power, linewidth=1.2, label=\"Electricity (DE/LU)\")\nax1.set_xlabel(\"Date\")\nax1.set_ylabel(\"Electricity Price (EUR/MWh)\", color=color_power)\nax1.tick_params(axis=\"y\", labelcolor=color_power)\n\nax2 = ax1.twinx()\ncolor_gas = \"tab:orange\"\nax2.plot(monthly_gas.index, monthly_gas.values,\n         color=color_gas, linewidth=1.2, label=\"TTF Gas\")\nax2.set_ylabel(\"TTF Gas Price (EUR/MWh)\", color=color_gas)\nax2.tick_params(axis=\"y\", labelcolor=color_gas)\n\nax1.set_title(\"Monthly Average Electricity vs Natural Gas Prices\")\nax1.grid(True, alpha=0.3)\n\n# Combined legend\nlines1, labels1 = ax1.get_legend_handles_labels()\nlines2, labels2 = ax2.get_legend_handles_labels()\nax1.legend(lines1 + lines2, labels1 + labels2, loc=\"upper left\")\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/smard-de-prices#electricity-prices-and-natural-gas","position":25},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Renewable Generation and Residual Load"},"type":"lvl2","url":"/notebooks/smard-de-prices#renewable-generation-and-residual-load","position":26},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Renewable Generation and Residual Load"},"content":"Residual load is the electricity demand that must be covered by\ndispatchable (controllable) power plants after subtracting variable\nrenewable generation:\\text{Residual Load} = \\text{Total Load} - \\text{Solar}\n  - \\text{Wind Onshore} - \\text{Wind Offshore}\n\nIt is the single most important driver of wholesale electricity prices:\n\nHigh residual load → more conventional plants must run, including\nexpensive gas turbines → higher prices\n\nLow / negative residual load → renewables cover (or exceed) demand →\ncheap plants suffice → lower prices (sometimes negative)\n\nThe stacked area chart below shows renewable generation (solar, onshore wind,\noffshore wind) against total electricity load. The gap between the top of the\nrenewables stack and the load line is the residual load.\n\n# Load generation and load data\nsolar = pd.read_parquet(paths.smard_solar_file)\nwind_on = pd.read_parquet(paths.smard_wind_onshore_file)\nwind_off = pd.read_parquet(paths.smard_wind_offshore_file)\ntotal_load = pd.read_parquet(paths.smard_total_load_file)\n\n# Combine into one DataFrame\ngen = pd.concat([\n    solar.rename(columns={solar.columns[0]: \"solar\"}),\n    wind_on.rename(columns={wind_on.columns[0]: \"wind_onshore\"}),\n    wind_off.rename(columns={wind_off.columns[0]: \"wind_offshore\"}),\n    total_load.rename(columns={total_load.columns[0]: \"total_load\"}),\n], axis=1).dropna()\n\ngen[\"renewables\"] = gen[\"solar\"] + gen[\"wind_onshore\"] + gen[\"wind_offshore\"]\ngen[\"residual_load\"] = gen[\"total_load\"] - gen[\"renewables\"]\n\nprint(f\"Generation data: {len(gen)} records\")\nprint(f\"Date range: {gen.index.min()} to {gen.index.max()}\")\n\n\n\n\n\n# Renewables vs total load (monthly averages for readability)\nmonthly_gen = gen.resample(\"ME\").mean()\n\nfig, ax = plt.subplots(figsize=(14, 6))\n\nax.stackplot(\n    monthly_gen.index,\n    monthly_gen[\"solar\"],\n    monthly_gen[\"wind_onshore\"],\n    monthly_gen[\"wind_offshore\"],\n    labels=[\"Solar\", \"Wind Onshore\", \"Wind Offshore\"],\n    alpha=0.7,\n)\nax.plot(monthly_gen.index, monthly_gen[\"total_load\"],\n        color=\"black\", linewidth=0.8, label=\"Total Load\")\n\nax.set_xlabel(\"Date\")\nax.set_ylabel(\"Power (MW)\")\nax.set_title(\"Renewable Generation vs Total Load (Monthly Averages)\")\nax.legend(loc=\"upper left\")\nax.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n# Monthly average residual load\nfig, ax = plt.subplots(figsize=(14, 6))\n\nax.plot(monthly_gen.index, monthly_gen[\"residual_load\"], color=\"tab:red\", linewidth=1.2)\nax.axhline(0, color=\"black\", linewidth=0.5, linestyle=\"--\")\nax.set_xlabel(\"Date\")\nax.set_ylabel(\"Residual Load (MW)\")\nax.set_title(\"Monthly Average Residual Load\")\nax.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/smard-de-prices#renewable-generation-and-residual-load","position":27},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Residual Load vs Electricity Price"},"type":"lvl2","url":"/notebooks/smard-de-prices#residual-load-vs-electricity-price","position":28},{"hierarchy":{"lvl1":"Electricity prices in Germany","lvl2":"Residual Load vs Electricity Price"},"content":"Because the merit order is roughly monotonic—cheap renewables first, then\ncoal/lignite, then gas—the price is largely determined by how far up the\nsupply curve demand reaches. Residual load measures exactly that.\n\nThe charts below zoom into three-week windows to show how hourly residual\nload and electricity prices move together. A linear fit\n(price = intercept + slope × residual load) is used to align the two\ny-axes so that the visual overlap reflects the statistical relationship.\n\nimport numpy as np\n\n# Align price and residual load on the same index\nprice_res = df[[\"PRICE_DE_LU\"]].join(gen[[\"residual_load\"]], how=\"inner\").dropna()\n\n\ndef plot_price_vs_residual(price_res_window, title_dates):\n    \"\"\"Plot price and residual load with axes aligned via a linear fit.\"\"\"\n    X = price_res_window[\"residual_load\"].values\n    y = price_res_window[\"PRICE_DE_LU\"].values\n    slope, intercept = np.polyfit(X, y, 1)\n    print(f\"Linear fit: price = {intercept:.2f} + {slope:.4f} × residual_load\")\n\n    fig, ax1 = plt.subplots(figsize=(14, 6))\n\n    color1 = \"tab:blue\"\n    ax1.plot(price_res_window.index, price_res_window[\"residual_load\"],\n             color=color1, linewidth=0.5, alpha=0.7, label=\"Residual Load\")\n    ax1.set_xlabel(\"Date\")\n    ax1.set_ylabel(\"Residual Load (MW)\", color=color1)\n    ax1.tick_params(axis=\"y\", labelcolor=color1)\n\n    ax2 = ax1.twinx()\n    color2 = \"tab:orange\"\n    ax2.plot(price_res_window.index, price_res_window[\"PRICE_DE_LU\"],\n             color=color2, linewidth=0.5, alpha=0.7, label=\"Price\")\n    ax2.set_ylabel(\"Price (EUR/MWh)\", color=color2)\n    ax2.tick_params(axis=\"y\", labelcolor=color2)\n\n    # Align the residual load axis to the price axis using the linear fit\n    p_lo, p_hi = ax2.get_ylim()\n    ax1.set_ylim((p_lo - intercept) / slope, (p_hi - intercept) / slope)\n\n    ax1.set_title(f\"Residual Load and Electricity Price ({title_dates})\")\n    ax1.grid(True, alpha=0.3)\n\n    lines1, labels1 = ax1.get_legend_handles_labels()\n    lines2, labels2 = ax2.get_legend_handles_labels()\n    ax1.legend(lines1 + lines2, labels1 + labels2, loc=\"upper left\")\n\n    fig.tight_layout()\n    plt.show()\n\n\n\n# Recent 3-week window (same as intraday section above)\nprice_res_sub = price_res.loc[start_date:end_date]\nprint(f\"Matched records: {len(price_res_sub)}\")\n\nplot_price_vs_residual(\n    price_res_sub,\n    f\"{start_date.strftime('%d %b')} – {end_date.strftime('%d %b %Y')}\",\n)\n\n\n\n\n\n# A second 3-week window in 2025 for comparison\nstart_2025 = pd.Timestamp(\"2025-06-01\")\nend_2025 = start_2025 + timedelta(weeks=3)\n\nprice_res_2025 = price_res.loc[start_2025:end_2025]\nprint(f\"Matched records (2025 window): {len(price_res_2025)}\")\n\nplot_price_vs_residual(\n    price_res_2025,\n    f\"{start_2025.strftime('%d %b')} – {end_2025.strftime('%d %b %Y')}\",\n)\n\n\n\n\n\nfrom IPython.display import Markdown\n\nMarkdown(f\"Last run: {datetime.now().strftime('%Y-%m-%d')}\")\n\n","type":"content","url":"/notebooks/smard-de-prices#residual-load-vs-electricity-price","position":29},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction"},"type":"lvl1","url":"/notebooks/reconstruct-prices","position":0},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction"},"content":"This notebook calculates the Short Run Marginal Costs (SRMC) of generating\nelectricity using hard coal and fossil gas, then uses a simplified merit\norder model to reconstruct wholesale electricity prices.","type":"content","url":"/notebooks/reconstruct-prices","position":1},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Approach"},"type":"lvl2","url":"/notebooks/reconstruct-prices#approach","position":2},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Approach"},"content":"Calculate SRMC for coal and gas power plants from commodity prices\n\nCalculate Fossil Residual Load: the demand that must be met by fossil plants\nafter accounting for renewables and baseload generationRL_{fossil} = \\text{Load} - (\\text{Wind} + \\text{Solar}) - (\\text{Nuclear} + \\text{Biomass} + \\text{Hydro}_{RoR})\n\nDetermine which fossil fuel (coal or gas) is cheaper based on SRMC\n\nAssign price based on merit order:\n\nIf RL_{fossil} \\leq \\text{cheaper capacity}: price = cheaper SRMC\n\nIf RL_{fossil} > \\text{cheaper capacity}: price = more expensive SRMC\n\nCompare reconstructed prices with actual market prices\n\n","type":"content","url":"/notebooks/reconstruct-prices#approach","position":3},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Short Run Marginal Costs (SRMC)"},"type":"lvl2","url":"/notebooks/reconstruct-prices#short-run-marginal-costs-srmc","position":4},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Short Run Marginal Costs (SRMC)"},"content":"The Short Run Marginal Cost (SRMC) represents the variable cost of producing\none additional MWh of electricity from a power plant. It determines the merit\norder position of generators in wholesale electricity markets.","type":"content","url":"/notebooks/reconstruct-prices#short-run-marginal-costs-srmc","position":5},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Components of SRMC","lvl2":"Short Run Marginal Costs (SRMC)"},"type":"lvl3","url":"/notebooks/reconstruct-prices#components-of-srmc","position":6},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Components of SRMC","lvl2":"Short Run Marginal Costs (SRMC)"},"content":"SRMC consists of three main components:\n\nFuel costs - The cost of the primary fuel (gas or coal) needed to\ngenerate electricity, adjusted for plant efficiency.\n\nCarbon costs - The cost of CO2 emissions under the EU Emissions Trading\nScheme (EU ETS), based on the carbon intensity of the fuel.\n\nVariable O&M costs - Operating and maintenance costs that vary with\nelectricity output.","type":"content","url":"/notebooks/reconstruct-prices#components-of-srmc","position":7},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Price References","lvl2":"Short Run Marginal Costs (SRMC)"},"type":"lvl3","url":"/notebooks/reconstruct-prices#price-references","position":8},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Price References","lvl2":"Short Run Marginal Costs (SRMC)"},"content":"Fossil Gas:\n\nDutch Title Transfer Facility (TTF) is the benchmark for gas traded in Europe\n\nOther European hubs (CEGH VTP, THE, PSV, etc.) trade at spreads to TTF\n\nPrices sourced from commodity exchanges (e.g., ICE, EEX)\n\nHard Coal:\n\nAPI 2 Rotterdam is the benchmark for coal imported into Northwest Europe\n\nFront month settlement prices in USD/metric ton\n\nThermal content approximately 6,000 kcal/kg (NAR)\n\nCarbon:\n\nEU ETS allowance prices (EUA) for the front December contract\n\nPrices in EUR per tonne CO2","type":"content","url":"/notebooks/reconstruct-prices#price-references","position":9},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Calculation Assumptions","lvl2":"Short Run Marginal Costs (SRMC)"},"type":"lvl3","url":"/notebooks/reconstruct-prices#calculation-assumptions","position":10},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Calculation Assumptions","lvl2":"Short Run Marginal Costs (SRMC)"},"content":"Parameter\n\nHard Coal\n\nFossil Gas\n\nEfficiency (HHV)\n\n40%\n\n50%\n\nCarbon intensity\n\n0.83 tCO2/MWh\n\n0.37 tCO2/MWh\n\nVariable O&M\n\n€2/MWh\n\n€2/MWh\n\nThe carbon intensity values represent emissions per MWh of electricity generated,\naccounting for the power plant efficiency.","type":"content","url":"/notebooks/reconstruct-prices#calculation-assumptions","position":11},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Why SRMC Matters","lvl2":"Short Run Marginal Costs (SRMC)"},"type":"lvl3","url":"/notebooks/reconstruct-prices#why-srmc-matters","position":12},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Why SRMC Matters","lvl2":"Short Run Marginal Costs (SRMC)"},"content":"In liberalized electricity markets, generators bid close to their marginal cost.\nThe SRMC comparison between coal and gas determines:\n\nFuel switching - When gas SRMC falls below coal, utilities switch from\ncoal to gas, reducing emissions\n\nPrice formation - The highest SRMC plant needed to meet demand often\nsets the wholesale electricity price\n\nInvestment signals - Persistent SRMC relationships influence new build\ndecisions and plant retirements\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nfrom sklearn.linear_model import LinearRegression\nfrom sklearn.metrics import r2_score\n\nfrom woe.paths import ProjPaths\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#why-srmc-matters","position":13},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"SRMC Calculation Parameters"},"type":"lvl2","url":"/notebooks/reconstruct-prices#srmc-calculation-parameters","position":14},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"SRMC Calculation Parameters"},"content":"\n\n# Power plant efficiency rates (Higher Heating Value / Gross Calorific Value)\nCOAL_EFFICIENCY = 0.40  # 40%\nGAS_EFFICIENCY = 0.50  # 50%\n\n# Carbon intensity (tCO2 per MWh of electricity generated)\nCOAL_CARBON_INTENSITY = 0.83  # tCO2/MWh\nGAS_CARBON_INTENSITY = 0.37  # tCO2/MWh\n\n# Variable Operating and Maintenance costs (EUR/MWh)\nVOM_COST = 2.0\n\n# Coal thermal content (MWh per metric ton)\n# API 2 coal specification: 6,000 kcal/kg NAR\n# 6,000 kcal/kg = 6,000,000 kcal/t ÷ 860,421 kcal/MWh ≈ 6.98 MWh/t\nCOAL_THERMAL_CONTENT = 6.98  # MWh/t\n\n# EUR/USD exchange rate (approximate)\nEURUSD_RATE = 1.08\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#srmc-calculation-parameters","position":15},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Load Data"},"type":"lvl2","url":"/notebooks/reconstruct-prices#load-data","position":16},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Load Data"},"content":"\n\npaths = ProjPaths()\n\n# Load generation and consumption data\nprint(\"Loading SMARD data...\")\nsolar = pd.read_parquet(paths.smard_solar_file)\nwind_onshore = pd.read_parquet(paths.smard_wind_onshore_file)\nwind_offshore = pd.read_parquet(paths.smard_wind_offshore_file)\ntotal_load = pd.read_parquet(paths.smard_total_load_file)\nprices = pd.read_parquet(paths.smard_prices_file)\ncapacities = pd.read_parquet(paths.smard_capacities_file)\n\nprint(f\"Generation data: {solar.index.min()} to {solar.index.max()}\")\nprint(f\"Prices: {prices.index.min()} to {prices.index.max()}\")\nprint(f\"Capacities: {capacities.index.min()} to {capacities.index.max()}\")\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#load-data","position":17},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Baseload Generation Data","lvl2":"Load Data"},"type":"lvl3","url":"/notebooks/reconstruct-prices#baseload-generation-data","position":18},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Baseload Generation Data","lvl2":"Load Data"},"content":"Nuclear, biomass, and hydro generation data for the fossil residual load calculation.\n\nprint(\"Loading baseload generation data...\")\nnuclear = pd.read_parquet(paths.smard_nuclear_file)\nbiomass = pd.read_parquet(paths.smard_biomass_file)\nhydro = pd.read_parquet(paths.smard_hydro_file)\n\nprint(f\"Nuclear: {len(nuclear)} records\")\nprint(f\"Biomass: {len(biomass)} records\")\nprint(f\"Hydro: {len(hydro)} records\")\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#baseload-generation-data","position":19},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Commodity Prices","lvl2":"Load Data"},"type":"lvl3","url":"/notebooks/reconstruct-prices#commodity-prices","position":20},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Commodity Prices","lvl2":"Load Data"},"content":"\n\ndef load_investing_com_csv(filepath: str) -> pd.Series:\n    \"\"\"Load price data from Investing.com CSV export.\"\"\"\n    df = pd.read_csv(\n        filepath,\n        encoding=\"utf-8-sig\",\n        parse_dates=[\"Date\"],\n        dayfirst=False,\n    )\n    df = df.set_index(\"Date\").sort_index()\n    return df[\"Price\"]\n\n\n\n# Load commodity prices\nprint(\"Loading commodity prices...\")\ngas_df = pd.read_parquet(paths.ttf_gas_prices_file)\ngas_prices = gas_df[\"Close\"].rename(\"gas_price\")\n\ncoal_prices = load_investing_com_csv(paths.rotterdam_coal_prices_file).rename(\n    \"coal_price\"\n)\n\ncarbon_prices = load_investing_com_csv(paths.eu_carbon_prices_file).rename(\n    \"carbon_price\"\n)\n\nprint(f\"Gas prices: {gas_prices.index.min()} to {gas_prices.index.max()}\")\nprint(f\"Coal prices: {coal_prices.index.min()} to {coal_prices.index.max()}\")\nprint(f\"Carbon prices: {carbon_prices.index.min()} to {carbon_prices.index.max()}\")\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#commodity-prices","position":21},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Calculate SRMC"},"type":"lvl2","url":"/notebooks/reconstruct-prices#calculate-srmc","position":22},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Calculate SRMC"},"content":"","type":"content","url":"/notebooks/reconstruct-prices#calculate-srmc","position":23},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Gas SRMC","lvl2":"Calculate SRMC"},"type":"lvl3","url":"/notebooks/reconstruct-prices#gas-srmc","position":24},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Gas SRMC","lvl2":"Calculate SRMC"},"content":"\\text{Gas SRMC} = \\frac{\\text{Gas Price}}{\\text{Efficiency}} + \\text{Carbon Intensity} \\times \\text{Carbon Price} + \\text{VOM}","type":"content","url":"/notebooks/reconstruct-prices#gas-srmc","position":25},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Coal SRMC","lvl2":"Calculate SRMC"},"type":"lvl3","url":"/notebooks/reconstruct-prices#coal-srmc","position":26},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Coal SRMC","lvl2":"Calculate SRMC"},"content":"\\text{Coal SRMC} = \\frac{\\text{Coal Price (EUR/MWh)}}{\\text{Efficiency}} + \\text{Carbon Intensity} \\times \\text{Carbon Price} + \\text{VOM}\n\nNote: Coal prices in USD/t need to be converted to EUR/MWh using:\n\nExchange rate (USD/EUR)\n\nThermal content (MWh/t)\n\n# Combine commodity prices (daily)\ncommodity_prices = pd.concat(\n    [gas_prices, coal_prices, carbon_prices], axis=1, join=\"inner\"\n)\ncommodity_prices = commodity_prices.ffill()\n\n# Convert coal from USD/t to EUR/MWh\ncoal_eur_mwh = commodity_prices[\"coal_price\"] / EURUSD_RATE / COAL_THERMAL_CONTENT\n\n# Calculate SRMC components\ngas_fuel_cost = commodity_prices[\"gas_price\"] / GAS_EFFICIENCY\ncoal_fuel_cost = coal_eur_mwh / COAL_EFFICIENCY\n\ngas_carbon_cost = GAS_CARBON_INTENSITY * commodity_prices[\"carbon_price\"]\ncoal_carbon_cost = COAL_CARBON_INTENSITY * commodity_prices[\"carbon_price\"]\n\n# Total SRMC (daily)\nsrmc_daily = pd.DataFrame(index=commodity_prices.index)\nsrmc_daily[\"gas_srmc\"] = gas_fuel_cost + gas_carbon_cost + VOM_COST\nsrmc_daily[\"coal_srmc\"] = coal_fuel_cost + coal_carbon_cost + VOM_COST\n\n# Store components for analysis\nsrmc_daily[\"gas_fuel_cost\"] = gas_fuel_cost\nsrmc_daily[\"gas_carbon_cost\"] = gas_carbon_cost\nsrmc_daily[\"coal_fuel_cost\"] = coal_fuel_cost\nsrmc_daily[\"coal_carbon_cost\"] = coal_carbon_cost\n\nprint(\"SRMC Summary (EUR/MWh):\")\nprint(srmc_daily[[\"gas_srmc\", \"coal_srmc\"]].describe().round(2))\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#coal-srmc","position":27},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"SRMC Time Series"},"type":"lvl2","url":"/notebooks/reconstruct-prices#srmc-time-series","position":28},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"SRMC Time Series"},"content":"\n\nfig, ax = plt.subplots(figsize=(14, 6))\n\nax.plot(srmc_daily.index, srmc_daily[\"gas_srmc\"], label=\"Gas SRMC\", linewidth=1, alpha=0.8)\nax.plot(srmc_daily.index, srmc_daily[\"coal_srmc\"], label=\"Coal SRMC\", linewidth=1, alpha=0.8)\n\nax.set_xlabel(\"Date\")\nax.set_ylabel(\"SRMC (EUR/MWh)\")\nax.set_title(\"Short Run Marginal Costs: Coal vs Gas\")\nax.legend()\nax.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#srmc-time-series","position":29},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Monthly Average SRMC"},"type":"lvl2","url":"/notebooks/reconstruct-prices#monthly-average-srmc","position":30},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Monthly Average SRMC"},"content":"\n\nmonthly_srmc = srmc_daily[[\"gas_srmc\", \"coal_srmc\"]].resample(\"ME\").mean()\n\nfig, ax = plt.subplots(figsize=(14, 6))\n\nax.plot(\n    monthly_srmc.index,\n    monthly_srmc[\"gas_srmc\"],\n    label=\"Gas SRMC\",\n    marker=\"o\",\n    markersize=3,\n)\nax.plot(\n    monthly_srmc.index,\n    monthly_srmc[\"coal_srmc\"],\n    label=\"Coal SRMC\",\n    marker=\"o\",\n    markersize=3,\n)\n\nax.set_xlabel(\"Date\")\nax.set_ylabel(\"SRMC (EUR/MWh)\")\nax.set_title(\"Monthly Average Short Run Marginal Costs\")\nax.legend()\nax.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#monthly-average-srmc","position":31},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Fuel Switching Indicator"},"type":"lvl2","url":"/notebooks/reconstruct-prices#fuel-switching-indicator","position":32},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Fuel Switching Indicator"},"content":"When gas SRMC is lower than coal SRMC, it is economically favorable to dispatch\ngas plants over coal plants, leading to lower emissions. This “fuel switching”\nis a key mechanism for carbon price effectiveness.\n\n# Calculate the spread (positive = gas cheaper than coal)\nsrmc_daily[\"spread\"] = srmc_daily[\"coal_srmc\"] - srmc_daily[\"gas_srmc\"]\n\nfig, axes = plt.subplots(2, 1, figsize=(14, 10), sharex=True)\n\n# SRMC comparison\nax1 = axes[0]\nax1.plot(srmc_daily.index, srmc_daily[\"gas_srmc\"], label=\"Gas SRMC\", linewidth=1, alpha=0.8)\nax1.plot(srmc_daily.index, srmc_daily[\"coal_srmc\"], label=\"Coal SRMC\", linewidth=1, alpha=0.8)\nax1.set_ylabel(\"SRMC (EUR/MWh)\")\nax1.set_title(\"Short Run Marginal Costs and Fuel Switching\")\nax1.legend()\nax1.grid(True, alpha=0.3)\n\n# Spread (coal - gas)\nax2 = axes[1]\nax2.fill_between(\n    srmc_daily.index,\n    srmc_daily[\"spread\"],\n    0,\n    where=srmc_daily[\"spread\"] >= 0,\n    color=\"green\",\n    alpha=0.5,\n    label=\"Gas cheaper (fuel switch)\",\n)\nax2.fill_between(\n    srmc_daily.index,\n    srmc_daily[\"spread\"],\n    0,\n    where=srmc_daily[\"spread\"] < 0,\n    color=\"red\",\n    alpha=0.5,\n    label=\"Coal cheaper\",\n)\nax2.axhline(y=0, color=\"black\", linestyle=\"-\", linewidth=0.5)\nax2.set_xlabel(\"Date\")\nax2.set_ylabel(\"Spread (EUR/MWh)\")\nax2.set_title(\"Coal-Gas Spread (positive = gas cheaper)\")\nax2.legend()\nax2.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#fuel-switching-indicator","position":33},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"SRMC Cost Components"},"type":"lvl2","url":"/notebooks/reconstruct-prices#srmc-cost-components","position":34},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"SRMC Cost Components"},"content":"Breaking down the SRMC into its fuel and carbon cost components shows the\nrelative importance of each driver.\n\nfig, axes = plt.subplots(1, 2, figsize=(14, 6))\n\n# Gas SRMC components\nax1 = axes[0]\nax1.stackplot(\n    srmc_daily.index,\n    srmc_daily[\"gas_fuel_cost\"],\n    srmc_daily[\"gas_carbon_cost\"],\n    [VOM_COST] * len(srmc_daily),\n    labels=[\"Fuel Cost\", \"Carbon Cost\", \"Variable O&M\"],\n    alpha=0.8,\n)\nax1.set_xlabel(\"Date\")\nax1.set_ylabel(\"Cost (EUR/MWh)\")\nax1.set_title(\"Gas SRMC Components\")\nax1.legend(loc=\"upper left\")\nax1.grid(True, alpha=0.3)\n\n# Coal SRMC components\nax2 = axes[1]\nax2.stackplot(\n    srmc_daily.index,\n    srmc_daily[\"coal_fuel_cost\"],\n    srmc_daily[\"coal_carbon_cost\"],\n    [VOM_COST] * len(srmc_daily),\n    labels=[\"Fuel Cost\", \"Carbon Cost\", \"Variable O&M\"],\n    alpha=0.8,\n)\nax2.set_xlabel(\"Date\")\nax2.set_ylabel(\"Cost (EUR/MWh)\")\nax2.set_title(\"Coal SRMC Components\")\nax2.legend(loc=\"upper left\")\nax2.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#srmc-cost-components","position":35},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Combine All Data"},"type":"lvl2","url":"/notebooks/reconstruct-prices#combine-all-data","position":36},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Combine All Data"},"content":"Align all data to hourly resolution by forward-filling daily/monthly data.\n\n# Combine generation data into single DataFrame\ndf = pd.concat(\n    [\n        solar.rename(columns={solar.columns[0]: \"solar\"}),\n        wind_onshore.rename(columns={wind_onshore.columns[0]: \"wind_onshore\"}),\n        wind_offshore.rename(columns={wind_offshore.columns[0]: \"wind_offshore\"}),\n        total_load.rename(columns={total_load.columns[0]: \"total_load\"}),\n        prices.rename(columns={prices.columns[0]: \"price\"}),\n        nuclear.rename(columns={nuclear.columns[0]: \"nuclear\"}),\n        biomass.rename(columns={biomass.columns[0]: \"biomass\"}),\n        hydro.rename(columns={hydro.columns[0]: \"hydro\"}),\n    ],\n    axis=1,\n)\n\n# Drop rows with missing generation/price data\ndf = df.dropna()\nprint(f\"Combined hourly data: {len(df)} records\")\nprint(f\"Date range: {df.index.min()} to {df.index.max()}\")\n\n\n\n\n\n# Forward-fill SRMC to hourly\n# Normalize index to date only for merging\ndf[\"date\"] = df.index.date\nsrmc_daily_reset = srmc_daily.copy()\nsrmc_daily_reset.index = srmc_daily_reset.index.date\n\ndf = df.merge(\n    srmc_daily_reset[[\"gas_srmc\", \"coal_srmc\"]],\n    left_on=\"date\",\n    right_index=True,\n    how=\"left\",\n)\ndf = df.drop(columns=[\"date\"])\n\n# Forward-fill any gaps in SRMC\ndf[\"gas_srmc\"] = df[\"gas_srmc\"].ffill()\ndf[\"coal_srmc\"] = df[\"coal_srmc\"].ffill()\n\n# Drop rows without SRMC data\ndf = df.dropna(subset=[\"gas_srmc\", \"coal_srmc\"])\nprint(f\"After SRMC merge: {len(df)} records\")\n\n\n\n# Forward-fill capacities to hourly\n# Capacities are monthly, so we need to reindex and forward-fill\ncapacities_hourly = capacities.reindex(df.index, method=\"ffill\")\n\n# Add relevant capacity columns to main DataFrame\ndf[\"capacity_coal\"] = (\n    capacities_hourly[\"brown_coal\"].fillna(0)\n    + capacities_hourly[\"hard_coal\"].fillna(0)\n)\ndf[\"capacity_gas\"] = capacities_hourly[\"natural_gas\"].fillna(0)\n\n# Drop rows without capacity data\ndf = df.dropna(subset=[\"capacity_coal\", \"capacity_gas\"])\nprint(f\"After capacity merge: {len(df)} records\")\nprint(f\"Final date range: {df.index.min()} to {df.index.max()}\")\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#combine-all-data","position":37},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Calculate Fossil Residual Load"},"type":"lvl2","url":"/notebooks/reconstruct-prices#calculate-fossil-residual-load","position":38},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Calculate Fossil Residual Load"},"content":"RL_{fossil} = \\text{Load} - (\\text{Wind} + \\text{Solar}) - (\\text{Nuclear} + \\text{Biomass} + \\text{Hydro})\n\n# Calculate components\ndf[\"wind\"] = df[\"wind_onshore\"] + df[\"wind_offshore\"]\ndf[\"renewables\"] = df[\"solar\"] + df[\"wind\"]\ndf[\"baseload\"] = df[\"nuclear\"] + df[\"biomass\"] + df[\"hydro\"]\n\n# Residual load for fossil plants\ndf[\"rl_fossil\"] = df[\"total_load\"] - df[\"renewables\"] - df[\"baseload\"]\n\n# Standard residual load (for comparison)\ndf[\"residual_load\"] = df[\"total_load\"] - df[\"renewables\"]\n\nprint(\"Fossil Residual Load Statistics (MW):\")\nprint(df[\"rl_fossil\"].describe().round(0))\n\n# Count negative fossil residual load hours\nnegative_hours = (df[\"rl_fossil\"] < 0).sum()\nprint(f\"\\nHours with negative RL_fossil: {negative_hours} ({100*negative_hours/len(df):.1f}%)\")\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#calculate-fossil-residual-load","position":39},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Reconstruct Prices Using Merit Order"},"type":"lvl2","url":"/notebooks/reconstruct-prices#reconstruct-prices-using-merit-order","position":40},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Reconstruct Prices Using Merit Order"},"content":"For each hour:\n\nDetermine which fuel (coal or gas) has lower SRMC\n\nIf fossil residual load can be met by cheaper fuel capacity alone, use cheaper SRMC\n\nOtherwise, use more expensive SRMC as the marginal price\n\ndef reconstruct_price(row):\n    \"\"\"Reconstruct electricity price based on merit order.\"\"\"\n    rl_fossil = row[\"rl_fossil\"]\n    gas_srmc = row[\"gas_srmc\"]\n    coal_srmc = row[\"coal_srmc\"]\n    capacity_coal = row[\"capacity_coal\"]\n    capacity_gas = row[\"capacity_gas\"]\n\n    # Handle negative residual load (renewable surplus)\n    if rl_fossil <= 0:\n        return 0.0  # Price floor at zero for simplicity\n\n    # Determine merit order based on SRMC\n    if coal_srmc <= gas_srmc:\n        # Coal is cheaper\n        cheaper_srmc = coal_srmc\n        expensive_srmc = gas_srmc\n        cheaper_capacity = capacity_coal\n    else:\n        # Gas is cheaper\n        cheaper_srmc = gas_srmc\n        expensive_srmc = coal_srmc\n        cheaper_capacity = capacity_gas\n\n    # Assign price based on which fuel is marginal\n    if rl_fossil <= cheaper_capacity:\n        return cheaper_srmc\n    else:\n        return expensive_srmc\n\n\n\n# Apply reconstruction\nprint(\"Reconstructing prices...\")\ndf[\"price_reconstructed\"] = df.apply(reconstruct_price, axis=1)\n\nprint(\"\\nReconstructed Price Statistics (EUR/MWh):\")\nprint(df[\"price_reconstructed\"].describe().round(2))\n\nprint(\"\\nActual Price Statistics (EUR/MWh):\")\nprint(df[\"price\"].describe().round(2))\n\n\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#reconstruct-prices-using-merit-order","position":41},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Compare Reconstructed vs Actual Prices"},"type":"lvl2","url":"/notebooks/reconstruct-prices#compare-reconstructed-vs-actual-prices","position":42},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Compare Reconstructed vs Actual Prices"},"content":"\n\n# Time series comparison (monthly averages)\nmonthly = df[[\"price\", \"price_reconstructed\"]].resample(\"ME\").mean()\n\nfig, ax = plt.subplots(figsize=(14, 6))\n\nax.plot(monthly.index, monthly[\"price\"], label=\"Actual Price\", linewidth=2)\nax.plot(\n    monthly.index,\n    monthly[\"price_reconstructed\"],\n    label=\"Reconstructed Price\",\n    linewidth=2,\n    linestyle=\"--\",\n)\n\nax.set_xlabel(\"Date\")\nax.set_ylabel(\"Price (EUR/MWh)\")\nax.set_title(\"Monthly Average: Actual vs Reconstructed Electricity Prices\")\nax.legend()\nax.grid(True, alpha=0.3)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#compare-reconstructed-vs-actual-prices","position":43},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Scatterplots"},"type":"lvl2","url":"/notebooks/reconstruct-prices#scatterplots","position":44},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Scatterplots"},"content":"\n\n# Sample data for scatterplots (performance)\nsample_size = min(50000, len(df))\nsample = df.sample(sample_size, random_state=42)\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#scatterplots","position":45},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Reconstructed Prices vs Actual Prices","lvl2":"Scatterplots"},"type":"lvl3","url":"/notebooks/reconstruct-prices#reconstructed-prices-vs-actual-prices","position":46},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Reconstructed Prices vs Actual Prices","lvl2":"Scatterplots"},"content":"\n\nfig, ax = plt.subplots(figsize=(10, 10))\n\nax.scatter(\n    sample[\"price_reconstructed\"],\n    sample[\"price\"],\n    alpha=0.1,\n    s=1,\n)\n\n# Add 45-degree line\nprice_range = [\n    min(sample[\"price\"].min(), sample[\"price_reconstructed\"].min()),\n    max(sample[\"price\"].max(), sample[\"price_reconstructed\"].max()),\n]\nax.plot(price_range, price_range, \"r--\", linewidth=1, label=\"Perfect fit\")\n\nax.set_xlabel(\"Reconstructed Price (EUR/MWh)\")\nax.set_ylabel(\"Actual Price (EUR/MWh)\")\nax.set_title(\"Reconstructed vs Actual Electricity Prices\")\nax.legend()\nax.grid(True, alpha=0.3)\n\n# Add R² annotation\nr2_reconstructed = r2_score(df[\"price\"], df[\"price_reconstructed\"])\nax.text(\n    0.05,\n    0.95,\n    f\"R² = {r2_reconstructed:.3f}\",\n    transform=ax.transAxes,\n    fontsize=12,\n    verticalalignment=\"top\",\n    bbox=dict(boxstyle=\"round\", facecolor=\"wheat\", alpha=0.5),\n)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#reconstructed-prices-vs-actual-prices","position":47},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Residual Load vs Actual Prices","lvl2":"Scatterplots"},"type":"lvl3","url":"/notebooks/reconstruct-prices#residual-load-vs-actual-prices","position":48},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Residual Load vs Actual Prices","lvl2":"Scatterplots"},"content":"\n\nfig, ax = plt.subplots(figsize=(10, 10))\n\nax.scatter(\n    sample[\"residual_load\"],\n    sample[\"price\"],\n    alpha=0.1,\n    s=1,\n)\n\nax.set_xlabel(\"Residual Load (MW)\")\nax.set_ylabel(\"Actual Price (EUR/MWh)\")\nax.set_title(\"Residual Load vs Electricity Price\")\nax.grid(True, alpha=0.3)\n\n# Add correlation\ncorr = df[\"residual_load\"].corr(df[\"price\"])\nax.text(\n    0.05,\n    0.95,\n    f\"Correlation: {corr:.3f}\",\n    transform=ax.transAxes,\n    fontsize=12,\n    verticalalignment=\"top\",\n    bbox=dict(boxstyle=\"round\", facecolor=\"wheat\", alpha=0.5),\n)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#residual-load-vs-actual-prices","position":49},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Fossil Residual Load vs Actual Prices","lvl2":"Scatterplots"},"type":"lvl3","url":"/notebooks/reconstruct-prices#fossil-residual-load-vs-actual-prices","position":50},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl3":"Fossil Residual Load vs Actual Prices","lvl2":"Scatterplots"},"content":"\n\nfig, ax = plt.subplots(figsize=(10, 10))\n\nax.scatter(\n    sample[\"rl_fossil\"],\n    sample[\"price\"],\n    alpha=0.1,\n    s=1,\n)\n\nax.set_xlabel(\"Fossil Residual Load (MW)\")\nax.set_ylabel(\"Actual Price (EUR/MWh)\")\nax.set_title(\"Fossil Residual Load vs Electricity Price\")\nax.grid(True, alpha=0.3)\n\n# Add correlation\ncorr_fossil = df[\"rl_fossil\"].corr(df[\"price\"])\nax.text(\n    0.05,\n    0.95,\n    f\"Correlation: {corr_fossil:.3f}\",\n    transform=ax.transAxes,\n    fontsize=12,\n    verticalalignment=\"top\",\n    bbox=dict(boxstyle=\"round\", facecolor=\"wheat\", alpha=0.5),\n)\n\nfig.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#fossil-residual-load-vs-actual-prices","position":51},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Variance Explained (R²)"},"type":"lvl2","url":"/notebooks/reconstruct-prices#variance-explained-r","position":52},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Variance Explained (R²)"},"content":"How much of the price variation is explained by each model?\n\n# Prepare data for regression (drop NaN and infinite values)\ndf_clean = df[[\"price\", \"residual_load\", \"rl_fossil\", \"price_reconstructed\"]].copy()\ndf_clean = df_clean.replace([np.inf, -np.inf], np.nan).dropna()\n\nX_residual = df_clean[[\"residual_load\"]].values\nX_fossil = df_clean[[\"rl_fossil\"]].values\nX_reconstructed = df_clean[[\"price_reconstructed\"]].values\ny = df_clean[\"price\"].values\n\n# Fit linear models\nmodel_residual = LinearRegression().fit(X_residual, y)\nmodel_fossil = LinearRegression().fit(X_fossil, y)\n\n# Calculate R² scores\nr2_residual = model_residual.score(X_residual, y)\nr2_fossil = model_fossil.score(X_fossil, y)\nr2_reconstructed = r2_score(y, df_clean[\"price_reconstructed\"].values)\n\nprint(\"=\" * 60)\nprint(\"VARIANCE EXPLAINED (R²)\")\nprint(\"=\" * 60)\nprint(f\"\\nResidual Load (linear regression):      R² = {r2_residual:.4f}\")\nprint(f\"Fossil Residual Load (linear regression): R² = {r2_fossil:.4f}\")\nprint(f\"Reconstructed Prices (merit order model): R² = {r2_reconstructed:.4f}\")\nprint()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#variance-explained-r","position":53},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Summary Statistics"},"type":"lvl2","url":"/notebooks/reconstruct-prices#summary-statistics","position":54},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Summary Statistics"},"content":"\n\n# Calculate additional metrics\nmae = np.abs(df_clean[\"price\"] - df_clean[\"price_reconstructed\"]).mean()\nrmse = np.sqrt(((df_clean[\"price\"] - df_clean[\"price_reconstructed\"]) ** 2).mean())\n\nprint(\"=\" * 60)\nprint(\"MODEL PERFORMANCE SUMMARY\")\nprint(\"=\" * 60)\nprint(f\"\\nMean Absolute Error (MAE):     {mae:.2f} EUR/MWh\")\nprint(f\"Root Mean Square Error (RMSE): {rmse:.2f} EUR/MWh\")\nprint(f\"\\nActual price mean:        {df_clean['price'].mean():.2f} EUR/MWh\")\nprint(f\"Reconstructed price mean: {df_clean['price_reconstructed'].mean():.2f} EUR/MWh\")\nprint()\n\n\n\n","type":"content","url":"/notebooks/reconstruct-prices#summary-statistics","position":55},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Comparison Chart: What Explains Price Variation?"},"type":"lvl2","url":"/notebooks/reconstruct-prices#comparison-chart-what-explains-price-variation","position":56},{"hierarchy":{"lvl1":"Fossil Fuel Costs and Electricity Price Reconstruction","lvl2":"Comparison Chart: What Explains Price Variation?"},"content":"\n\nfig, ax = plt.subplots(figsize=(10, 6))\n\nmodels = [\"Residual Load\\n(Linear)\", \"Fossil RL\\n(Linear)\", \"Merit Order\\n(Reconstructed)\"]\nr2_values = [r2_residual, r2_fossil, r2_reconstructed]\ncolors = [\"#3498db\", \"#2ecc71\", \"#e74c3c\"]\n\nbars = ax.bar(models, r2_values, color=colors, edgecolor=\"black\", linewidth=1.2)\n\n# Add value labels on bars\nfor bar, val in zip(bars, r2_values):\n    height = bar.get_height()\n    ax.text(\n        bar.get_x() + bar.get_width() / 2.0,\n        height + 0.01,\n        f\"{val:.3f}\",\n        ha=\"center\",\n        va=\"bottom\",\n        fontsize=12,\n        fontweight=\"bold\",\n    )\n\nax.set_ylabel(\"R² (Variance Explained)\")\nax.set_title(\"How Much Price Variation is Explained?\")\nax.set_ylim(0, 1.0)\nax.grid(True, alpha=0.3, axis=\"y\")\n\nfig.tight_layout()\nplt.show()\n\n\n\nfrom datetime import datetime\nfrom IPython.display import Markdown\n\nMarkdown(f\"Last run: {datetime.now().strftime('%Y-%m-%d')}\")\n\n","type":"content","url":"/notebooks/reconstruct-prices#comparison-chart-what-explains-price-variation","position":57}]}